# Tempus - 勤怠管理システム 要求・要件定義

## プロジェクト概要
個人用の勤怠管理システム「Tempus」。WebアプリケーションとDiscord Botの両方から出退勤を打刻でき、データを一元管理する。

---

## 要求のブラッシュアップ結果

### 1. 打刻機能
- **打刻種類**: 出勤・退勤の2種類のみ
  - 休憩・外出・リモート区別は不要
- **打刻方法**:
  - Webサイトのボタンから打刻
  - Discordのスラッシュコマンドから打刻
- **過去の打刻**: 任意の日時で打刻を追加可能

### 2. データ管理機能
- **打刻履歴の一覧表示**: 時系列で打刻記録を表示
- **月次集計**: 月ごとの勤務時間を自動計算して表示
- **打刻の編集**:
  - 過去の打刻を修正・削除可能
  - 編集された打刻は視覚的に区別（例: 背景色、アイコンなど）
  - 編集時にコメントを残せる（修正理由などを記録）
  - 通常の打刻と編集された打刻は見た目が変わる

### 3. Discord連携
- **打刻方法**: スラッシュコマンドのみ
- **通知**:
  - Webから打刻 → Discordの特定チャンネルに通知
  - Discordから打刻 → 同じチャンネルに確認メッセージ
- **ユーザー識別**: Discord IDで個人を識別

### 4. 認証
- **Web**: Basic認証のみ
- **Discord**: Discord IDによる自動識別

### 5. 使用シーン
- 個人利用を想定
- WebとDiscord両方をメインで使用

---

## 決定事項

### Discord連携
1. **アカウント連携方法**: 環境変数で設定（個人利用のため）
2. **スラッシュコマンド**: `/tempus` のみ（引数なし、自動判定）
   - 出勤/退勤をユーザー側が指定する必要なし
   - システムが最新の状態から自動判定
3. **通知チャンネル**: チャンネルIDを環境変数で指定

### データ表示
4. **月次集計の内容**:
   - 総勤務時間（時間:分形式）
   - 勤務日数
5. **一覧表示の範囲**:
   - デフォルトで当月分を表示
   - 月切り替えで過去の履歴も閲覧可能
   - 全履歴を一度に見る機能は不要

### 勤務時間計算ルール
6. **1日の定義**: AM 6:00 ～ 翌日 AM 6:00
   - 例: 1月1日 = 1/1 06:00:00 ～ 1/2 05:59:59
7. **退勤未打刻の扱い**:
   - 退勤が押されていない日はアラートUIを表示
   - 勤務時間の自動計算はせず、ユーザーに退勤打刻を促す

### UI設計
8. **編集済み打刻の見た目**: デザイナーに任せる（視覚的に区別できればOK）
9. **打刻ボタンのテキスト**: 状態に応じて変更
   - 未出勤/退勤済み → 「出勤する」
   - 出勤中 → 「退勤する」

---

## 機能要件詳細

### 1. 打刻機能

#### 1.1 自動判定打刻
- `/tempus` コマンドまたはWebボタンで打刻
- システムが最新の勤怠状態を判定し、自動で出勤/退勤を切り替え
  - 未出勤 or 退勤済み → 出勤として記録
  - 出勤中 → 退勤として記録

#### 1.2 打刻データ
各打刻レコードには以下を記録：
- 打刻日時（タイムスタンプ）
- 種類（出勤/退勤）
- 打刻方法（Web/Discord）
- 編集フラグ（手動編集されたか）
- 編集コメント（任意）

#### 1.3 過去打刻の追加
- 任意の日時で打刻を追加可能
- 追加時に日時を指定するUI
- 自動的に「編集済み」として記録

### 2. 履歴管理機能

#### 2.1 打刻履歴一覧
- 月単位で表示（デフォルト: 当月）
- 月切り替えUI（前月/次月ボタン）
- 表示項目：
  - 日時
  - 種類（出勤/退勤）
  - 打刻元（Web/Discord）
  - 編集マーク（編集済みの場合）
  - 編集コメント（ある場合）

#### 2.2 打刻の編集・削除
- 各打刻レコードを個別に編集・削除可能
- 編集時：
  - 日時の変更
  - コメントの追加・編集
  - 編集後は視覚的に区別
- 削除時：
  - 確認ダイアログ表示
  - 物理削除（データベースから完全削除）

#### 2.3 月次集計
- 選択中の月の統計を表示：
  - **総勤務時間**（時間:分形式）例: 160:30
  - **勤務日数**
- 出勤/退勤のペアから勤務時間を自動計算
- **退勤未打刻の日**: アラートUIを表示（勤務時間には含めない）

#### 2.4 勤務時間計算ルール
- **1日の定義**: AM 6:00 ～ 翌日 AM 6:00
  - 例: 2025-01-01 = 2025/01/01 06:00:00 ～ 2025/01/02 05:59:59
  - 深夜勤務にも対応（日跨ぎを考慮）
- 出勤と退勤のペアで勤務時間を計算
- 退勤が記録されていない場合は計算対象外とし、アラート表示

### 3. Discord連携

#### 3.1 スラッシュコマンド
- コマンド: `/tempus`
- 引数なし（自動判定）
- 実行するとその時点で打刻を記録

#### 3.2 通知機能
- **Webから打刻時**: Discordの指定チャンネルに通知
- **Discordから打刻時**: 同じチャンネルに確認メッセージ
- 通知内容：
  - 打刻種類（出勤/退勤）
  - 打刻時刻
  - ユーザー識別情報

#### 3.3 ユーザー識別
- Discord IDでユーザーを識別
- 環境変数で対象のDiscord IDを設定

### 4. 認証機能

#### 4.1 Web認証
- Basic認証のみ
- ユーザー名・パスワードは環境変数で設定

#### 4.2 Discord認証
- Discord IDによる自動識別
- 環境変数に登録されたIDのみコマンド実行可能

---

## 非機能要件

### パフォーマンス
- 打刻処理は3秒以内に完了
- 履歴一覧の表示は5秒以内

### データ保存
- データベースに永続化
- バックアップ機能は不要（個人利用）

### 対応環境
- モダンブラウザ（Chrome, Firefox, Safari最新版）
- レスポンシブ不要（PC前提）

---

## 画面構成

### メイン画面
- **ヘッダー**
  - アプリ名表示
  - 打刻ボタン（大きく目立つ）
    - テキストは状態に応じて「出勤する」/「退勤する」
  - 現在の状態表示（出勤中/退勤済み）

- **月次集計エリア**
  - 総勤務時間
  - 勤務日数
  - 月切り替えボタン（前月/次月）

- **履歴一覧**
  - 打刻レコードのリスト
  - 各レコードに編集/削除ボタン
  - 退勤未打刻の日はアラート表示

### 編集モーダル
- 日時入力フィールド
- コメント入力フィールド
- 保存/キャンセルボタン
